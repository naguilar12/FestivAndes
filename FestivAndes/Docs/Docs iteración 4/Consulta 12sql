WITH BOLETA_LOCALIDAD AS (SELECT * FROM(BOLETA INNER JOIN LOCALIDAD ON ID_LOCALIDAD=ID)),
     BOLETAS_VIP AS(SELECT ID_CLIENTE, COUNT(*) AS BOLETAS_COMPRADAS FROM BOLETA_LOCALIDAD WHERE NOMBRE = 'VIP' AND ESTADO IN (1,2) GROUP BY ID_CLIENTE),
     BOLETAS_POR_CLIENTE AS (SELECT ID_CLIENTE, COUNT(*) AS BOLETAS_COMPRADAS FROM BOLETA GROUP BY ID_CLIENTE),
     BUENOS_CLIENTES AS (SELECT * FROM (BOLETAS_VIP NATURAL JOIN BOLETAS_POR_CLIENTE) WHERE ID_CLIENTE != 99 AND BOLETAS_COMPRADAS >= 2),
     INFO_BUENOS_USUARIOS AS (SELECT* FROM(BUENOS_CLIENTES INNER JOIN USUARIO ON ID_CLIENTE = ID)),
     INFO_BUENOS_CLIENTES AS (SELECT * FROM (INFO_BUENOS_USUARIOS INNER JOIN CLIENTE ON CLIENTE.ID = ID_CLIENTE))
     
SELECT * FROM INFO_BUENOS_CLIENTES;

SELECT * FROM BOLETAS_VIP;
SELECT * FROM BOLETAS_POR_CLIENTE;

